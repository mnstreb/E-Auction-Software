<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction Estimate Calculator</title>
    <!-- Link to Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Link to Chart.js for the pie chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Base styles and UI improvements */
        body {
            margin: 0;
            font-family: 'Inter var', system-ui, -apple-system, sans-serif; /* Added Inter var for modern feel */
            background: linear-gradient(135deg, #e0f2fe 0%, #c1e0fa 100%); /* Lighter, softer blue gradient */
            min-height: 100vh;
            color: #374151; /* Default text color */
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            background: white;
            border-radius: 16px; /* Slightly more rounded */
            box-shadow: 0 6px 25px rgba(0,0,0,0.08); /* Softer, larger shadow */
            padding: 30px; /* More padding */
            margin-bottom: 25px;
        }
        .input-field {
            width: 100%;
            padding: 10px 14px; /* Larger padding */
            border: 1px solid #d1d5db; /* Softer border */
            border-radius: 8px; /* More rounded */
            font-size: 15px; /* Slightly larger font */
            transition: border-color 0.2s, box-shadow 0.2s;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.04); /* Subtle inner shadow */
        }
        .input-field:focus {
            outline: none;
            border-color: #60a5fa; /* Lighter blue focus */
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3); /* Subtle blue glow */
        }
        .btn {
            padding: 12px 25px; /* More padding */
            border-radius: 10px; /* More rounded */
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease-in-out; /* Smoother transition */
            border: none;
            font-size: 15px;
        }
        .btn-primary {
            background: #2563eb; /* Deeper blue (Tailwind blue-600) */
            color: white;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.2);
        }
        .btn-primary:hover {
            background: #1D4ED8; /* Even deeper blue (Tailwind blue-700) */
            box-shadow: 0 6px 20px rgba(29, 78, 216, 0.3);
            transform: translateY(-1px); /* Slight lift */
        }
        .btn-green {
            background: #10b981; /* Brighter green (Tailwind emerald-500) */
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2);
        }
        .btn-green:hover {
            background: #059669; /* Deeper green (Tailwind emerald-600) */
            box-shadow: 0 6px 20px rgba(5, 150, 105, 0.3);
            transform: translateY(-1px);
        }
        .btn-red {
            background: #ef4444; /* Brighter red (Tailwind red-500) */
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.2);
        }
        .btn-red:hover {
            background: #dc2626; /* Deeper red (Tailwind red-600) */
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.3);
            transform: translateY(-1px);
        }

        table {
            width: 100%;
            border-collapse: separate; /* Allows border-radius on cells */
            border-spacing: 0; /* Remove space between cells */
        }
        th, td {
            padding: 15px; /* More padding */
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background: #f3f4f6; /* Softer header background */
            font-weight: 600;
            color: #4b5563;
            position: sticky; /* Sticky header for scrollable tables */
            top: 0;
            z-index: 1;
            white-space: nowrap; /* Prevent wrapping in headers */
            font-size: 0.9em; /* Slightly smaller font for headers */
        }
        /* Rounded corners for table header */
        th:first-child { border-top-left-radius: 10px; }
        th:last-child { border-top-right-radius: 10px; } /* This might apply to the last TH of the whole table. Need to be mindful of multi-colspan headers. */

        /* Center text for the multi-colspan headers */
        th.text-center {
            text-align: center;
        }

        tr:nth-child(even) {
            background: #f8fafc; /* Subtle zebra striping */
        }
        tr:hover {
            background: #e0f2fe; /* Light blue on hover */
            transition: background 0.15s ease-in-out;
        }
        .setup-wizard {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6); /* Slightly darker overlay */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px); /* Subtle blur effect */
        }
        .wizard-content {
            background: white;
            border-radius: 20px; /* More rounded */
            padding: 45px; /* More padding */
            max-width: 650px; /* Slightly wider */
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2); /* Stronger shadow */
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 35px; /* More spacing */
        }
        .step {
            width: 45px; /* Larger step circles */
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 12px;
            font-weight: bold;
            font-size: 18px; /* Larger number */
            transition: background 0.3s, color 0.3s;
        }
        .step.active {
            background: #3b82f6;
            color: white;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
        }
        .step.inactive {
            background: #e5e7eb;
            color: #6b7280;
        }
        .form-group {
            margin-bottom: 25px; /* More spacing between form groups */
        }
        .label {
            display: block;
            margin-bottom: 8px; /* More space below label */
            font-weight: 600;
            color: #4b5563; /* Softer label color */
            font-size: 15px;
        }
        h1 {
            font-size: 32px;
            color: #1f2937;
            margin-bottom: 15px !important; /* Ensure consistent heading margin */
        }
        h2 {
            font-size: 26px;
            color: #1f2937;
            margin-bottom: 25px !important;
        }
        h3 {
            font-size: 22px;
            color: #1f2937;
            margin-bottom: 20px !important;
        }
        /* Specific styles for the project info header in main app */
        .header-info-container {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap; /* Allows wrapping on smaller screens */
        }
        /* Reverted header-icon-box to be a rounded rectangle, matching the "most up-to-date" immersive from the user's prompt */
        .header-icon-box {
            background: #3b82f6;
            padding: 15px;
            border-radius: 12px; /* Rounded rectangle */
            display: flex;
            align-items: center;
            justify-content: center;
            width: 64px; /* Fixed size */
            height: 64px;
            overflow: hidden; /* Hide overflow for images */
        }
        .header-logo-img { /* Style for the actual logo image */
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; /* Ensure image fits without cropping */
        }
        .header-title-container {
            line-height: 1.3;
        }
        .header-title {
            margin: 0;
            color: #1f2937;
            font-size: 28px;
            font-weight: 700; /* Make title bolder */
        }
        .header-subtitle {
            margin: 5px 0 0 0;
            color: #6b7280;
            font-size: 16px;
        }
        /* Small adjustment for the action buttons in the header */
        .header-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px; /* Add margin for small screens */
        }

        /* Top Summary Row Styles (3 columns: Proposal, Hours, Chart) */
        .top-summary-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* Explicitly 3 columns on large screens */
            gap: 20px;
            margin-bottom: 25px;
        }
        .summary-overall-metric-card {
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%); /* Deeper blue gradient for prominence */
            color: white;
            text-align: center;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(29, 78, 216, 0.3);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 150px; /* Ensure some height */
        }
        .summary-overall-metric-card .label {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: rgba(255,255,255,0.9);
        }
        .summary-overall-metric-card .value {
            font-size: 3rem; /* Larger font for main value */
            font-weight: 800;
            line-height: 1;
        }
         /* Pie Chart specific styles (now in top row, also a card) */
        .chart-container.card { /* Make it a card for consistent styling */
            padding: 20px; /* Adjust padding for visual balance */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 150px; /* Match height of other top cards if possible */
        }
        .chart-canvas {
            max-width: 100%; /* Make chart responsive */
            max-height: 200px; /* Adjust max height for top row display */
            height: auto;
            width: auto; /* Allow chart.js to manage width within limits */
        }
        .chart-container.card h4 { /* Style the title of the chart in the new layout */
            font-size: 1.1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 10px;
            text-align: center;
        }


        /* Executive Summary Grid (now 3 columns) specific styles */
        .executive-summary-grid-3col { /* Renamed class for clarity */
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* Explicitly 3 columns on large screens */
            gap: 20px;
        }
        .executive-summary-grid-3col .card { /* Ensure cards within this grid don't have extra bottom margin */
            margin-bottom: 0;
        }
        .summary-block h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 10px;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            font-size: 0.95rem;
            color: #4b5563;
        }
        .summary-item strong {
            color: #1f2937;
        }
        .summary-item.total {
            font-weight: bold;
            font-size: 1.1rem;
            color: #0d47a1; /* Darker blue for totals */
            border-top: 1px dashed #cbd5e1;
            margin-top: 8px;
            padding-top: 8px;
        }


        /* Responsive adjustments */
        @media (max-width: 1024px) { /* Adjust grid for medium screens */
            .top-summary-row {
                grid-template-columns: repeat(2, 1fr); /* 2 columns on medium screens */
            }
            .executive-summary-grid-3col { /* Renamed class */
                grid-template-columns: repeat(2, 1fr); /* 2 columns on medium screens */
            }
            /* Adjust table for smaller screens */
            table, thead, tbody, th, td, tr {
                display: block; /* Make table elements stack for smaller screens */
            }
            thead tr {
                position: absolute;
                top: -9999px; /* Hide table headers visually on small screens */
                left: -9999px;
            }
            tr {
                border: 1px solid #ccc; /* Add border to rows */
                margin-bottom: 10px;
                border-radius: 8px; /* Rounded corners for rows */
                overflow: hidden; /* Hide overflow for rounded corners */
            }
            td {
                border: none; /* Remove individual cell borders */
                position: relative;
                padding-left: 50%; /* Make space for pseudo-element labels */
                text-align: right;
                font-size: 14px;
            }
            td:before {
                /* Create a label for each cell using data-label attribute */
                content: attr(data-label);
                position: absolute;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
                color: #4b5563;
            }
            /* Specific adjustments for input fields in responsive table cells */
            td .input-field, td select {
                width: calc(100% - 10px); /* Adjust width to fit within cell padding */
                text-align: right; /* Align input text to the right */
            }
            td:nth-of-type(1):before { content: "Task Name:"; }
            td:nth-of-type(2):before { content: "Description:"; }
            td:nth-of-type(3):before { content: "OT/DT Multiplier:"; }
            td:nth-of-type(4):before { content: "Skill:"; }
            td:nth-of-type(5):before { content: "$/hr:"; }
            td:nth-of-type(6):before { content: "# hrs:"; }
            td:nth-of-type(7):before { content: "Labor Total:"; }
            td:nth-of-type(8):before { content: "QTY / UNIT:"; }
            td:nth-of-type(9):before { content: "$ / UNIT:"; }
            td:nth-of-type(10):before { content: "Materials Total:"; }
            td:nth-of-type(11):before { content: "Equipment / Rental:"; }
            td:nth-of-type(12):before { content: "Subcontractor:"; }
            td:nth-of-type(13):before { content: "Misc.:"; }
            td:nth-of-type(14):before { content: "Other Total:"; }
            td:nth-of-type(15):before { content: "TOTAL:"; }
            td:nth-of-type(16):before { content: "Actions:"; }

        }

        @media (max-width: 768px) {
            .card, .wizard-content {
                padding: 20px;
                margin-bottom: 15px;
            }
            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
            .header-title {
                font-size: 24px;
            }
            .header-subtitle {
                font-size: 15px;
            }
            /* Removed th, td font-size adjust for more consistent mobile labels */

            .summary-overall-metric-card {
                padding: 20px;
            }
            .summary-overall-metric-card .label {
                font-size: 1.2rem;
            }
            .summary-overall-metric-card .value {
                font-size: 2.5rem;
            }
            .top-summary-row, .executive-summary-grid-3col { /* Renamed class */
                grid-template-columns: 1fr; /* Stack columns on small screens */
            }
            .chart-container.card h4 {
                font-size: 1rem; /* Smaller title for chart on mobile */
            }
        }

        /* Specific styles for multi-select dropdown */
        .multi-select-container {
            position: relative;
        }
        .multi-select-dropdown {
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 8px;
            max-height: 150px;
            overflow-y: auto;
            background-color: white;
            position: absolute;
            width: 100%;
            z-index: 10;
            box-shadow: 0 44x 6px rgba(0,0,0,0.1);
        }
        .multi-select-dropdown label {
            display: block;
            padding: 6px 10px;
            cursor: pointer;
        }
        .multi-select-dropdown label:hover {
            background-color: #f3f4f6;
        }
        .multi-select-dropdown input[type="checkbox"] {
            margin-right: 8px;
        }
        .selected-trades-display {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            min-height: 40px;
            cursor: pointer;
            background-color: white;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
        }
        .selected-trade-tag {
            background-color: #e0f2fe; /* Light blue tag */
            color: #1e40af; /* Dark blue text */
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .selected-trade-tag .remove-tag {
            cursor: pointer;
            font-weight: bold;
            color: #94a3b8; /* Gray for X */
        }
        /* Styles for dynamic labor rate inputs in wizard */
        .trade-labor-rates-group {
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px; /* Space between trade groups */
            background-color: #fcfcfc;
        }
        .trade-labor-rates-group h3 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.25rem;
            color: #1f2937;
            padding-bottom: 10px; /* Space below header */
            border-bottom: 1px solid #e5e7eb; /* Separator for trade header */
        }

        .skill-level-row {
            display: flex;
            align-items: center; /* Align to the center of the content in the row */
            margin-bottom: 15px;
            gap: 15px; /* Increased space between skill name and rate input */
            padding-bottom: 10px; /* Add some padding below each row */
            border-bottom: 1px dashed #e5e7eb; /* Subtle separator for skill rows */
            justify-content: space-between; /* Pushes skill name to left, rate input to right */
        }
        .skill-level-row:last-child {
            margin-bottom: 0;
            border-bottom: none; /* No border for the last one */
            padding-bottom: 0;
        }

        .skill-name-display { /* New class for plain text skill name */
            font-weight: 600;
            color: #1f2937;
            font-size: 15px;
            flex-shrink: 0; /* Prevent shrinking if content is long */
            width: 150px; /* Give it a fixed width for alignment */
        }

        /* Adjustments for the rate input to align with the design */
        .rate-input-group { /* Combined rate label, input, and delete button */
            display: flex;
            align-items: center;
            gap: 8px; /* Space between rate label, input, and delete button */
            flex-grow: 1; /* Allow to grow and take remaining space */
            justify-content: flex-end; /* Push rate input to the right within its group */
        }
        .rate-label {
            white-space: nowrap; /* Prevent label from wrapping */
            font-weight: 600;
            color: #4b5563;
            font-size: 15px;
            margin-right: 0; /* Remove previous margin-right */
        }
        .rate-input { /* Specific class for the rate input field */
            width: 100px; /* Fixed width for rate input for consistent alignment */
            flex-shrink: 0; /* Prevent shrinking */
        }
        /* Style for editable skill name input */
        .skill-name-input.editable {
            width: 150px; /* Match width of skill-name-display */
            padding: 10px 14px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 15px;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.04);
            transition: border-color 0.2s, box-shadow 0.2s;
            flex-shrink: 0;
            box-sizing: border-box; /* Include padding and border in the width */
        }
        .skill-name-input.editable:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3);
        }


        /* Smaller, aligned remove button */
        .remove-skill-btn {
            background-color: #ef4444; /* Red */
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px; /* Smaller width */
            height: 24px; /* Smaller height */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px; /* Smaller font for minus/X */
            line-height: 1;
            cursor: pointer;
            flex-shrink: 0; /* Don't shrink the button */
            transition: background-color 0.2s ease;
            margin-bottom: 0; /* No bottom margin needed */
            margin-left: 0; /* No explicit margin-left needed, gap handles it */
            position: static; /* Remove relative positioning */
            top: auto; /* Remove top adjustment */
        }
        .remove-skill-btn:hover {
            background-color: #dc2626; /* Darker red */
        }

        .advanced-link-wrapper {
            width: 100%;
            text-align: left; /* Align to the left */
            margin-top: 20px; /* Space above the button bar */
        }
        .advanced-link {
            color: #2563eb; /* Primary blue color for the link */
            text-decoration: underline;
            font-size: 0.95rem;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .advanced-link:hover {
            color: #1D4ED8; /* Darker blue on hover */
        }

        /* Styles for the logo upload area (Step 1 of wizard) - REVERTED TO RECTANGULAR */
        .logo-upload-area {
            background: #f8fafc; /* Light gray background */
            border: 2px dashed #cbd5e1; /* Dashed border */
            border-radius: 12px; /* Rectangular with rounded corners */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px; /* Generous padding */
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            min-height: 120px; /* Ensure some minimum height */
            gap: 10px; /* Space between crane and text */
            position: relative; /* For positioning the image */
            overflow: hidden; /* Hide overflow for image */
        }
        .logo-upload-area:hover {
            background: #e0f2fe; /* Lighter blue on hover */
            border-color: #60a5fa; /* Blue border on hover */
        }
        .logo-upload-area.drag-over {
            background: #dbeafe; /* Even lighter blue when dragging over */
            border-color: #3b82f6; /* Solid blue border when dragging over */
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.4);
        }

        /* Image preview within the upload area (for wizard) */
        .logo-upload-area .wizard-logo-img-preview {
            max-width: 100%;
            max-height: 100px; /* Limit height of uploaded logo in wizard */
            object-fit: contain; /* Ensure image fits without cropping */
            border-radius: 8px; /* Slightly rounded corners for the logo itself */
        }

        /* Default icon and text when no logo is loaded (always visible in this format) */
        .logo-upload-area .default-icon {
            font-size: 32px;
            color: #3b82f6;
        }
        .logo-upload-area .upload-text {
            font-size: 0.9rem;
            color: #6b7280;
        }
        /* Removed .logo-upload-overlay and its related styles as per the new requested format */

        /* Hide spinner arrows for number input fields within the table */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield; /* Firefox */
        }

        /* Custom styles for Task Name and Description fields to make them wider */
        /* Increased min-width of the table to ensure horizontal scroll if needed */
        table.min-w-full {
            min-width: 1400px; /* Increased minimum width for better spacing */
            width: 100%; /* Still allows stretching if screen is wider */
        }

        /* General td padding adjustment for a more compact look */
        #estimateTableBody td {
            padding: 8px 10px;
        }

        /* Styles for Task Name and Description Textareas */
        #estimateTableBody td:nth-child(1) textarea, /* Task Name */
        #estimateTableBody td:nth-child(2) textarea { /* Description */
            white-space: normal; /* Allow text to wrap */
            height: auto; /* Auto height based on content */
            min-height: 40px; /* Minimum height for visibility */
            box-sizing: border-box;
            resize: vertical; /* Allow vertical resizing */
            overflow-y: auto; /* Add scrollbar if content exceeds min-height */
        }
        /* Ensure these textareas fill their cell width */
        #estimateTableBody td:nth-child(1) textarea,
        #estimateTableBody td:nth-child(2) textarea {
            width: 100%; /* Fill the cell */
            max-width: none; /* Override any max-width */
        }

        /* Styles for compact numerical input fields and selects */
        #estimateTableBody input[type="number"],
        #estimateTableBody select {
            width: 70px; /* A fixed, smaller width for numerical inputs */
            font-size: 0.9em; /* Smaller font for inputs */
            padding: 6px 8px; /* Reduced padding */
            box-sizing: border-box; /* Include padding/border in width */
            text-align: right; /* Align numbers to the right */
        }

        /* Specific width adjustments for 'Skill' and 'OT/DT' selects */
        #estimateTableBody td:nth-child(3) select, /* OT/DT Multiplier */
        #estimateTableBody td:nth-child(4) select { /* Skill */
            width: 90px; /* Slightly more space for selects */
            text-align: left; /* Keep text aligned left for selections */
        }

        /* Keep currency output and total values on one line and bold */
        #estimateTableBody td:nth-child(5), /* $/hr */
        #estimateTableBody td:nth-child(7), /* Labor Total */
        #estimateTableBody td:nth-child(10), /* Materials Total */
        #estimateTableBody td:nth-child(14), /* Other Total */
        #estimateTableBody td:nth-child(15) { /* TOTAL */
            white-space: nowrap;
            font-weight: bold;
            color: #1f2937; /* Darker text for totals */
            text-align: right; /* Align currency/totals to the right */
        }
        
        /* Adjust actions column button size */
        #estimateTableBody td button.btn-red {
            padding: 6px 10px; /* Smaller padding for action button */
            font-size: 0.85em; /* Smaller font */
        }
        
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Main Application Interface -->
    <div id="mainApp" class="container hidden">
        <div class="card mb-6">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                <div class="header-info-container">
                    <div class="header-icon-box">
                        <img id="mainAppLogo" class="header-logo-img" src="" alt="Contractor Logo" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCI+PC9jaXJjbGU+PHBhdGggZD0iTTE2LjIgNy44TDIwLjIgMTEuOE0zLjggMTIuMkw3LjggMTYuMiIvPjxwYXRoIGQ9Ik03LjggNy44TDExLjggMy44TDEyLjIgMy44TDE2LjIgNy44Ii8+PHBhdGggZD0iTTE2LjIgMTYuMkwxMi4yIDIwLjJMMTguOCAyMC4yTDcuOCAxNi4yIi8+PC9zdmc+'">
                        <!-- Default SVG if no logo or error -->
                    </div>
                    <div class="header-title-container">
                        <h1 class="header-title">Construction Estimate Calculator</h1>
                        <p class="header-subtitle" id="projectInfo">Commercial Construction Project</p>
                    </div>
                </div>
                <div class="header-buttons">
                    <button class="btn btn-primary" onclick="window.app.showSetup()">⚙️ Reconfigure</button>
                    <button class="btn btn-green" onclick="window.app.generateReport()">📄 Generate Report</button>
                </div>
            </div>
        </div>

        <!-- NEW: Top-level summary boxes with Executive Summary -->
        <div class="top-summary-row mb-6">
            <div class="summary-overall-metric-card">
                <span class="label">Total Proposal</span>
                <span class="value" id="summaryTotalProposal">$0.00</span>
            </div>
            <div class="summary-overall-metric-card">
                <span class="label">Total Labor Hours</span>
                <span class="value" id="summaryOverallLaborHours">0</span>
            </div>
            <!-- Executive Summary (MOVED HERE) -->
            <div class="card summary-block">
                <h4>Executive Summary</h4>
                <div class="summary-item"><span>Total Project Cost:</span> <strong id="summaryProjectCost">$0.00</strong></div>
                <div class="summary-item"><span>Total Misc Cost:</span> <strong id="summaryMiscCost">$0.00</strong></div>
                <div class="summary-item"><span>Total Overhead:</span> <strong id="summaryOverhead">$0.00</strong></div>
                <div class="summary-item"><span>Total Markup:</span> <strong id="summaryMarkup">$0.00</strong></div>
                <div class="summary-item"><span>Estimate Subtotal:</span> <strong id="summaryEstimateSubtotal">$0.00</strong></div>
                <div class="summary-item"><span>Profit Margin (%):</span> <strong id="summaryProfitMargin">0.00%</strong></div>
                <div class="summary-item"><span>Sales Tax (%):</span> <strong id="summarySalesTax">0.00%</strong></div>
                <div class="summary-item"><span>Misc. (%):</span> <strong id="summaryMiscPercent">0.00%</strong></div>
                <div class="summary-item"><span>Additional Considerations:</span> <strong id="summaryAdditionalConsiderations">$0.00</strong></div>
            </div>
        </div>

        <!-- Executive Summary Grid (now 3 columns, but without Executive Summary card) -->
        <div class="executive-summary-section mb-6">
            <div class="executive-summary-grid-3col">
                <div class="card summary-block">
                    <h4>Labor Breakdown (Hours)</h4>
                    <div class="summary-item"><span>Project Manager:</span> <strong id="laborPMTotal">0.00</strong></div>
                    <div class="summary-item"><span>Superintendent:</span> <strong id="laborSuperintendentTotal">0.00</strong></div>
                    <div class="summary-item"><span>General Foreman:</span> <strong id="laborGeneralForemanTotal">0.00</strong></div>
                    <div class="summary-item"><span>Foreman:</span> <strong id="laborForemanTotal">0.00</strong></div>
                    <div class="summary-item"><span>Journeyman:</span> <strong id="laborJourneymanTotal">0.00</strong></div>
                    <div class="summary-item"><span>Apprentice:</span> <strong id="laborApprenticeTotal">0.00</strong></div>
                </div>

                <div class="card summary-block">
                    <h4>Project Cost Breakdown</h4>
                    <div class="summary-item"><span>Labor Total:</span> <strong id="breakdownLaborTotal">$0.00</strong></div>
                    <div class="summary-item"><span>Material Total:</span> <strong id="breakdownMaterialTotal">$0.00</strong></div>
                    <div class="summary-item"><span>Equipment Total:</span> <strong id="breakdownEquipmentTotal">$0.00</strong></div>
                    <div class="summary-item"><span>Sub-contractor Total:</span> <strong id="breakdownSubcontractorTotal">$0.00</strong></div>
                    <div class="summary-item"><span>Misc. Total (Line Items):</span> <strong id="breakdownMiscCost">0.00</strong></div>
                    <div class="summary-item total"><span>Total Other Costs:</span> <strong id="breakdownOtherTotal">$0.00</strong></div>
                </div>

                <!-- Pie Chart Container (MOVED HERE) -->
                <div class="chart-container card">
                    <h4 style="margin-top:0;">Labor vs. Material Cost Distribution</h4>
                    <canvas id="laborMaterialPieChart" class="chart-canvas"></canvas>
                </div>
            </div>
        </div>

        <div class="card overflow-x-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-semibold text-gray-800">Estimate Line Items</h3>
                <button class="btn btn-green" onclick="window.app.addItem()">➕ Add Item</button>
            </div>
            <table class="min-w-full">
                <thead>
                    <tr>
                        <th rowspan="2" class="task-name-col">Task Name</th>
                        <th rowspan="2" class="description-col">Description</th>
                        <th colspan="5" class="text-center labor-col">LABOR</th>
                        <th colspan="3" class="text-center materials-col">MATERIALS</th>
                        <th colspan="3" class="text-center other-col">OTHER</th>
                        <th rowspan="2" class="total-col">TOTAL</th>
                        <th rowspan="2" class="actions-col">Actions</th>
                    </tr>
                    <tr>
                        <th class="border-b">OT/DT</th>
                        <th class="border-b">Skill</th>
                        <th class="border-b">$/hr</th>
                        <th class="border-b"># hrs</th>
                        <th class="border-b">Labor Total</th>
                        <th class="border-b">QTY / UNIT</th>
                        <th class="border-b">$ / UNIT</th>
                        <th class="border-b">Materials Total</th>
                        <th class="border-b">Equipment / Rental</th>
                        <th class="border-b">Subcontractor</th>
                        <th class="border-b">Misc.</th>
                    </tr>
                </thead>
                <tbody id="estimateTableBody">
                    </tbody>
            </table>
        </div>
    </div>

    <div id="setupWizard" class="setup-wizard">
        <div class="wizard-content">
            <div style="text-align: center; margin-bottom: 30px;">
                <!-- Logo Upload Area -->
                <input type="file" id="logoUploadInput" accept="image/*" style="display: none;">
                <div id="logoUploadArea" class="logo-upload-area"
                     ondragover="event.preventDefault(); this.classList.add('drag-over');"
                     ondragleave="this.classList.remove('drag-over');"
                     ondrop="window.app.handleLogoDrop(event); this.classList.remove('drag-over');"
                     onclick="document.getElementById('logoUploadInput').click();">
                    <img id="wizardLogoPreview" class="uploaded-logo hidden" src="" alt="Contractor Logo">
                    <span id="defaultLogoIcon" class="default-icon">🏗️</span>
                    <p id="uploadText" class="upload-text">Drag & drop your logo here, or click to upload</p>
                </div>

                <h1>Project Setup</h1>
                <p style="color: #6b7280;">Let's configure your estimate for accuracy</p>
            </div>

            <div class="step-indicator">
                <div id="step1" class="step active">1</div>
                <div id="step2" class="step inactive">2</div>
                <div id="step3" class="step inactive">3</div>
            </div>

            <div id="wizardStep1">
                <h2 class="text-xl font-semibold mb-6">Project Information</h2>
                <div class="form-group">
                    <label for="projectName" class="label">Project Name:</label>
                    <input type="text" id="projectName" class="input-field" value="Commercial Construction Project" required>
                </div>
                <div class="form-group">
                    <label for="clientName" class="label">Client Name/Company:</label>
                    <input type="text" id="clientName" class="input-field" placeholder="e.g., Acme Corp." required>
                </div>
                <div class="form-group">
                    <label for="projectType" class="label">Project Type:</label>
                    <select id="projectType" class="input-field" required>
                        <option value="Commercial">Commercial</option>
                        <option value="Residential">Residential</option>
                        <option value="Industrial">Industrial</option>
                        <option value="Renovation">Renovation</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="projectState" class="label">State/Location:</label>
                    <select id="projectState" class="input-field" required>
                        <option value="CA">California</option>
                        <option value="TX">Texas</option>
                        <option value="NY">New York</option>
                        <option value="FL">Florida</option>
                        <option value="WA">Washington</option>
                        <option value="IL">Illinois</option>
                        <option value="AL">Alabama</option> <option value="AK">Alaska</option> <option value="AZ">Arizona</option> <option value="AR">Arkansas</option> <option value="CO">Colorado</option> <option value="CT">Connecticut</option> <option value="DE">Delaware</option> <option value="GA">Georgia</option> <option value="HI">Hawaii</option> <option value="ID">Idaho</option> <option value="IN">Indiana</option> <option value="IA">Iowa</option> <option value="KS">Kansas</option> <option value="KY">Kentucky</option> <option value="LA">Louisiana</option> <option value="ME">Maine</option> <option value="MD">Maryland</option> <option value="MA">Massachusetts</option> <option value="MI">Michigan</option> <option value="MN">Minnesota</option> <option value="MS">Mississippi</option> <option value="MO">Missouri</option> <option value="MT">Montana</option> <option value="NE">Nebraska</option> <option value="NV">Nevada</s option> <option value="NH">New Hampshire</option> <option value="NJ">New Jersey</option> <option value="NM">New Mexico</option> <option value="NC">North Carolina</option> <option value="ND">North Dakota</option> <option value="OH">Ohio</option> <option value="OK">Oklahoma</option> <option value="OR">Oregon</option> <option value="PA">Pennsylvania</option> <option value="RI">Rhode Island</option> <option value="SC">South Carolina</option> <option value="SD">South Dakota</option> <option value="TN">Tennessee</s option> <option value="UT">Utah</option> <option value="VT">Vermont</option> <option value="VA">Virginia</s option> <option value="WV">West Virginia</option> <option value="WI">Wisconsin</option> <option value="WY">Wyoming</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="tradesInvolved" class="label">Trades Involved (Select multiple):</label>
                    <div class="multi-select-container">
                        <input type="text" id="tradeSearchInput" class="input-field mb-2" placeholder="Search trades..." onfocus="window.app.showTradeDropdown()" onblur="window.app.hideTradeDropdown()">
                        <div id="selectedTradesDisplay" class="selected-trades-display" onclick="window.app.toggleTradeDropdown()">
                            Click to select trades...
                        </div>
                        <div id="tradesDropdown" class="multi-select-dropdown hidden">
                            <!-- Checkboxes will be populated here by JS -->
                        </div>
                    </div>
                </div>

                <!-- Advanced Details Section -->
                <div class="advanced-link-wrapper mt-6">
                    <a href="#" class="advanced-link" id="showAdvancedDetailsLink" onclick="window.app.toggleAdvancedDetails(event)">Show Advanced Details</a>
                </div>

                <div id="advancedDetailsSection" class="hidden mt-4 pt-4 border-t border-gray-200">
                    <h4 class="font-semibold text-lg mb-3">Additional Project Information</h4>
                    <div class="form-group">
                        <label for="projectAddress" class="label">Project Street Address:</label>
                        <input type="text" id="projectAddress" class="input-field" placeholder="e.g., 123 Main St.">
                    </div>
                    <div class="form-group">
                        <label for="projectCity" class="label">City:</label>
                        <input type="text" id="projectCity" class="input-field" placeholder="e.g., Anytown">
                    </div>
                    <div class="form-group">
                        <label for="projectZip" class="label">Zip Code:</label>
                        <input type="text" id="projectZip" class="input-field" placeholder="e.g., 90210">
                    </div>
                    <div class="form-group">
                        <label for="startDate" class="label">Start Date:</label>
                        <input type="date" id="startDate" class="input-field">
                    </div>
                    <div class="form-group">
                        <label for="endDate" class="label">End Date (Optional):</label>
                        <input type="date" id="endDate" class="input-field">
                    </div>
                    <div class="form-group">
                        <label for="projectID" class="label">Project ID/Number:</label>
                        <input type="text" id="projectID" class="input-field" placeholder="e.g., PROJ-001">
                    </div>
                     <div class="form-group">
                        <label for="projectDescription" class="label">Project Description/Scope Summary:</label>
                        <textarea id="projectDescription" class="input-field" rows="4" placeholder="Briefly describe the project scope..."></textarea>
                    </div>
                </div>


                <div class="flex justify-end gap-3 mt-8">
                    <button class="btn btn-primary" onclick="window.app.nextStep(1)">Next</button>
                </div>
            </div>

            <div id="wizardStep2" class="hidden">
                <h2 class="text-xl font-semibold mb-6">Labor Rates Configuration</h2>
                <p class="text-gray-600 mb-4">Enter the hourly rates for each skill level within the selected trades.</p>
                
                <!-- Container for dynamic labor rate inputs (now a simple list) -->
                <div id="dynamicLaborRateInputs" class="grid gap-4"> 
                    <!-- Dynamic labor rate items will be injected here -->
                </div>

                <!-- Advanced link at the bottom-left -->
                <div class="advanced-link-wrapper">
                    <a href="#" class="advanced-link" id="advancedLink" onclick="window.app.toggleAdvancedRates(event)">Show Advanced Options</a>
                </div>
                
                <!-- Advanced section for adding new skill levels - hidden by default -->
                <div id="advancedSkillLevelControls" class="hidden mt-6 pt-4 border-t border-gray-200">
                    <h4 class="font-semibold text-lg mb-3">Add Custom Skill Level</h4>
                    <div class="form-group">
                        <label for="newSkillTitle" class="label">New Skill Title:</label>
                        <input type="text" id="newSkillTitle" class="input-field" placeholder="e.g., Lead Journeyman">
                    </div>
                    <div class="form-group">
                        <label for="newSkillRate" class="label">New Skill Rate ($/hr):</label>
                        <input type="number" id="newSkillRate" class="input-field" value="0">
                    </div>
                    <button class="btn btn-primary w-full mt-2" onclick="window.app.addSkillLevelFromAdvanced()">Add Skill Level</button>
                </div>

                <div class="flex justify-between gap-3 mt-8">
                    <button class="btn btn-primary" onclick="window.app.prevStep(2)">Previous</button>
                    <button class="btn btn-primary" onclick="window.app.nextStep(2)">Next</button>
                </div>
            </div>

            <div id="wizardStep3" class="hidden">
                <h2 class="text-xl font-semibold mb-6">Project Settings</h2>

                <!-- Overhead -->
                <div class="form-group">
                    <label for="overhead" class="label">Overhead (%):</label>
                    <input type="number" id="overhead" class="input-field" value="0" step="0.01">
                </div>

                <!-- Desired Profit -->
                <div class="form-group">
                    <label for="profitMargin" class="label">Desired Profit (%):</label>
                    <input type="number" id="profitMargin" class="input-field" value="0" step="0.01">
                </div>

                <!-- Sales Tax -->
                <div class="form-group">
                    <label for="salesTax" class="label">Sales Tax (%):</label>
                    <input type="number" id="salesTax" class="input-field" value="0" step="0.01">
                </div>
                
                <div class="form-group">
                    <label for="miscellaneous" class="label">Miscellaneous (%):</label>
                    <input type="number" id="miscellaneous" class="input-field" value="0" step="0.01">
                </div>

                <!-- Additional Project Considerations with Toggle -->
                <div class="form-group">
                    <label class="label">Additional Project Considerations:</label>
                    <div class="flex items-center gap-3">
                        <input type="number" id="additionalConsiderationsValue" class="input-field flex-grow" value="0" step="0.01">
                        <span id="additionalConsiderationsUnit" class="font-semibold text-gray-600 w-10 text-center">%</span>
                        <button type="button" class="btn btn-primary btn-sm" onclick="window.app.toggleAdditionalConsiderationsType()">Toggle</button>
                    </div>
                </div>

                <div class="flex justify-between gap-3 mt-8">
                    <button class="btn btn-primary" onclick="window.app.prevStep(3)">Previous</button>
                    <button class="btn btn-green" onclick="window.app.startEstimating()">Start Estimating</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script src="js/ui-elements.js"></script>
    <script src="js/messageBox.js"></script>
    <script src="js/wizard.js"></script>
    <script src="js/laborRates.js"></script>
    <script src="js/calculator.js"></script>
    <script src="js/report.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
